<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Logros</title>
    <link rel="stylesheet" href="../public/style.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="biblioteca.js"></script>
</head>
<body>
    <header>
        <a href="../index.html" class="back-btn" style="color:var(--accent-java); position: absolute; left: 20px; text-decoration: none;"><i data-lucide="arrow-left" style="width: 20px; height: 20px;"></i> Volver</a>
        <h1 id="edition-title">Cargando Logros...</h1>
        <p id="edition-info"></p>
    </header>

    <main id="logros-container" class="edition-selector">
        <p id="loading-message">Cargando datos de logros...</p>
    </main>

    <footer>
        <p>&copy; 2024 Minecraft Achievement Wiki</p>
    </footer>

    <script>
        lucide.createIcons();
        window.logroData = window.logroData || {}; // Inicializa el contenedor de datos

        const urlParams = new URLSearchParams(window.location.search);
        const edition = urlParams.get('edition') || 'java';
        document.getElementById('edition-title').textContent = `Logros de Minecraft (${edition.toUpperCase()})`;
        document.getElementById('edition-info').textContent = edition === 'java' ? 'Avances (Java Edition)' : 'Logros (Bedrock Edition)';

        const container = document.getElementById('logros-container');
        const loadingMessage = document.getElementById('loading-message');

        // Función para cargar dinámicamente los archivos JS individuales
        async function loadAchievementDetails() {
            const achievements = window.LOGROS_MASTER_LIST.filter(l => l.edition.includes(edition));

            const filePromises = achievements.map(logro => {
                return new Promise((resolve, reject) => {
                    const script = document.createElement('script');
                    script.src = logro.file;
                    script.onload = resolve;
                    script.onerror = () => reject(`Fallo al cargar ${logro.file}`);
                    document.head.appendChild(script);
                });
            });

            await Promise.all(filePromises).catch(err => console.error("Error crítico cargando archivos JS:", err));

            loadingMessage.style.display = 'none';
            container.innerHTML = ''; // Limpiar el mensaje de carga

            if (window.logroData) {
                achievements.forEach(meta => {
                    const details = window.logroData[meta.id];
                    if (details) {
                        const card = document.createElement('div');
                        card.className = 'card achievement-card';
                        
                        const requiredText = details.requirements[edition] || details.description;
                        const editionInfo = details.editionSpecific[edition];
                        
                        let bonusInfo = '';
                        if (edition === 'java' && editionInfo && editionInfo.xp !== undefined) {
                            bonusInfo = `<p class="xp">Recompensa: <i data-lucide="sparkles"></i> ${editionInfo.xp} XP</p>`;
                        } else if (edition === 'bedrock' && editionInfo && editionInfo.gamerscore !== undefined) {
                            bonusInfo = `<p class="gs">Gamerscore: <i data-lucide="trophy"></i> ${editionInfo.gamerscore}</p>`;
                        }

                        card.innerHTML = `
                            <h2 style="margin-top: 0;">${details.name}</h2>
                            <p style="font-style: italic;">${details.description}</p>
                            <hr>
                            <p><strong>Categoría:</strong> ${meta.category}</p>
                            <p class="req"><strong>Requisito:</strong> ${requiredText}</p>
                            ${bonusInfo}
                            <div style="margin-top: 15px; padding: 10px; background: #181825; border-radius: 6px;">
                                <i data-lucide="lightbulb" style="width: 16px; height: 16px; color: yellow; margin-right: 5px;"></i>
                                <small><strong>Tip:</strong> ${details.tip}</small>
                            </div>
                        `;
                        container.appendChild(card);
                    }
                });
            }
            lucide.createIcons(); // Vuelve a renderizar íconos recién inyectados
        }

        loadAchievementDetails();
    </script>
</body>
</html>